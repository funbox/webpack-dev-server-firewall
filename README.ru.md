# @funboxteam/webpack-dev-server-firewall

## Описание

Пакет предотвращает неконтролируемый доступ к разработческому серверу,
выдавая предупреждение при подключении с незнакомого IP.

## Установка

```bash
npm install --save-dev @funboxteam/webpack-dev-server-firewall
```

## Использование

Для того, чтобы пакет начал работать, необходимо подключить его в конфиге
webpack, в разделе devServer.before (или devServer.setup, [если webpack-dev-server@<2.9.0](https://github.com/webpack/webpack-dev-server/releases/tag/v2.9.0)):

```js
const firewall = require('@funboxteam/webpack-dev-server-firewall');

module.exports = {
  // ...
  devServer: {
    // ...
    before: firewall,
  },
};
```

Функция `firewall` ожидает [Express application](https://expressjs.com/en/4x/api.html#app) в качестве аргумента,
потому, если в проекте уже используются какие-то хуки, можно сделать так:

```js
 const firewall = require('@funboxteam/webpack-dev-server-firewall');
 
 module.exports = {
   // ...
   devServer: {
     // ...
     before(app) {
       firewall(app);
       // ...
     },
   },
 };
```

Важно, что в таком случае желательно подключать `firewall` до всех остальных обработчиков.

По умолчанию пакет пропускает только запросы с `127.0.0.1`.
Если возникнет запрос с иного IP, обработчик запросит подтверждение:

```text
Child serviceworker-plugin:
     1 asset
    Entrypoint undefined = sw.js
    [./src/app/sw.js] 2.82 KiB {0} [built]
ℹ ｢wdm｣: Compiled with warnings.
# ↑ там лог webpack
192.168.1.46 is trying to get access to the server. Allow? [yes / no]:
``` 

Если пользователь согласится на подключение, IP будет добавлен в список разрешённых,
и все последующие подключения с него не будут блокироваться:

```text
192.168.1.46 has been added to known hosts.
``` 

Если пользователь запретит подключение, клиент, с которого пришёл запрос, 
получит ответ с кодом 403.

## Важные детали

1. Пакет **не** работает как фильтр нежелательных соединений. 
   
   Если пользователь запретил соединение однажды, это не значит, 
   что оно будет игнорироваться и дальше. При повторном подключении с этого IP 
   пакет снова выдаст предупреждение и запросит подтверждение.
   
2. Пакет **не** гарантирует полную защиту от злоумышленников.

   Поскольку он никак не проверяет, что IP, с которого приходит новый запрос,
   принадлежит той же машине, с которой когда-то пришёл подтверждённый запрос,
   из этого следует, что при изменении настроек DHCP (или легче: при подключении к другой сети)
   правила, по которым выдавались IP-адреса в локальной сети могут измениться,
   из-за чего ранее подтвеждённый адрес может достаться новой машине, с которой 
   и будут совершены запросы злоумышленником.
   
3. Список разрешённых адресов хранится в `~/.funbox_webpack_known_hosts`.

   Если необходимо удалить оттуда какой-то адрес, можно сделать это вручную.
   
   Помимо прочего это означает, что список разрешённых IP один на все проекты.
   
4. Во избежание ошибок пакет ожидает в качестве ответа на подтверждение `yes` или `no`.

   Короткий ответ вроде `y` недопустим. Любой ответ кроме `yes` приравнивается к `no`.
